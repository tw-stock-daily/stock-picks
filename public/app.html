<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>台股精選｜今日推薦</title>

  <style>
    :root{
      --bg:#0b1220;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:rgba(255,255,255,.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --good:#34d399;
      --warn:#fbbf24;
      --bad:#fb7185;
      --hot:#f59e0b;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: linear-gradient(180deg, #060a12, var(--bg));
      color:var(--text);
    }
    .wrap{max-width: 980px; margin:0 auto; padding: 16px;}
    .title{font-size:20px; font-weight:800;}
    .sub{font-size:12px; color:var(--muted);}
    .card{
      background: rgba(17,26,46,.55);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      margin-bottom: 12px;
    }
    .btn{
      background:#1f2937;
      border:1px solid var(--line);
      color:var(--text);
      padding:6px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:12px;
      font-weight:700;
    }
    .btn.active{
      background:#2563eb;
      border-color:#2563eb;
    }
    .filter-bar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:8px;
    }
    .pick{
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      margin-bottom:10px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    .name{font-weight:800;}
    .score{font-weight:900;}
    .hint{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
    }
  </style>
</head>

<body>
<div class="wrap">

  <div class="card">
    <div class="title">台股精選｜今日推薦</div>
    <div class="sub" id="updated">更新時間：讀取中…</div>

    <!-- ✅ 價格區間選擇 -->
    <div class="filter-bar" id="priceFilter">
      <button class="btn active" data-range="all">不限</button>
      <button class="btn" data-range="lt100">100 以內</button>
      <button class="btn" data-range="100_300">100 ~ 300</button>
      <button class="btn" data-range="300_600">300 ~ 600</button>
      <button class="btn" data-range="600_1000">600 ~ 1000</button>
      <button class="btn" data-range="gt1000">1000 以上</button>
    </div>
  </div>

  <div id="pickList"></div>
  <div class="sub" id="emptyHint" style="display:none;">此價格區間目前沒有推薦股票</div>

</div>

<script>
const TODAY_URL = "./today.json";

let ALL_PICKS = [];
let CURRENT_RANGE = "all";

function priceInRange(price, range){
  if (price == null || !Number.isFinite(price)) return false;
  switch(range){
    case "lt100": return price < 100;
    case "100_300": return price >= 100 && price < 300;
    case "300_600": return price >= 300 && price < 600;
    case "600_1000": return price >= 600 && price < 1000;
    case "gt1000": return price >= 1000;
    default: return true;
  }
}

function render(){
  const box = document.getElementById("pickList");
  box.innerHTML = "";

  const filtered = ALL_PICKS.filter(p =>
    priceInRange(p.lastClose, CURRENT_RANGE)
  );

  document.getElementById("emptyHint").style.display =
    filtered.length ? "none" : "block";

  filtered.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "pick";
    div.innerHTML = `
      <div class="row">
        <div>
          <div class="name">#${i+1} ${p.symbol} ${p.name}</div>
          <div class="hint">收盤價：${p.lastClose?.toFixed(2) ?? "—"} ｜ ${p.tradeStyle || ""}</div>
        </div>
        <div class="score">${p.score?.toFixed(1) ?? "-"}</div>
      </div>
      <div class="hint">
        進場：${p.plan?.entryLow?.toFixed(2)} ~ ${p.plan?.entryHigh?.toFixed(2)}　
        止損：${p.plan?.stop?.toFixed(2)}
      </div>
    `;
    box.appendChild(div);
  });
}

async function load(){
  const r = await fetch(TODAY_URL, { cache:"no-store" });
  const data = await r.json();
  document.getElementById("updated").textContent =
    "更新時間：" + (data.generatedAt || "—");
  ALL_PICKS = data.picks || [];
  render();
}

document.getElementById("priceFilter").onclick = (e) => {
  if (!e.target.dataset.range) return;
  CURRENT_RANGE = e.target.dataset.range;
  [...document.querySelectorAll("#priceFilter .btn")]
    .forEach(b => b.classList.toggle("active", b.dataset.range === CURRENT_RANGE));
  render();
};

load();
</script>

</body>
</html>
